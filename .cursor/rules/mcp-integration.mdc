---
description: Model Context Protocol (MCP) for AI integration
---
# Model Context Protocol (MCP) Integration

The MCP module enables AI assistants to interact with the home automation system.

## MCP Server

- Location: [app/server/modules/mcp/](mdc:app/server/modules/mcp/)
- Main server: [app/server/modules/mcp/server.ts](mdc:app/server/modules/mcp/server.ts)
- Routing: [app/server/modules/mcp/routing.ts](mdc:app/server/modules/mcp/routing.ts)

## Authentication

MCP uses bearer token authentication:
- Tokens are stored in the MCP database (`mcp.json`)
- Generate keys with: `bun generate-mcp-key`
- Manage keys with: `bun manage-mcp-keys`
- Authorization header: `Authorization: Bearer <token>`

## MCP Tools

Tools are defined in the routing module and expose home automation functionality:
- Device control (lights, switches, etc.)
- Status queries
- Configuration changes
- Scene activation

## Creating MCP Tools

```typescript
server.tool(
    'tool_name',
    'Tool description for AI',
    {
        // Zod schema for parameters
        param1: z.string().describe('Parameter description'),
    },
    async (args) => {
        // Tool implementation
        return {
            content: [
                {
                    type: 'text',
                    text: 'Result',
                },
            ],
        };
    }
);
```

## Transport

Uses StreamableHTTPServerTransport from `@modelcontextprotocol/sdk`:
- HTTP-based transport for streaming
- Session management
- Standard MCP protocol compliance

## Module Integration

MCP can access all other modules via the module system:
```typescript
const modules = await this.config.modules;
await modules.switch.toggleDevice(deviceId);
```